# Codecov Configuration for chrom-rs
# Chromatography Simulation Library
# Documentation: https://docs.codecov.com/docs/codecov-yaml
#
# Architecture: component_management (approche moderne)
# Un seul upload de couverture suffit dans le workflow,
# codecov découpe automatiquement les résultats par composant.

# ============================================================================
# PARAMÈTRES GLOBAUX
# ============================================================================
codecov:
  require_ci_to_pass: yes
  notify:
    wait_for_ci: yes

# ============================================================================
# COUVERTURE GÉNÉRALE
# ============================================================================
coverage:
  precision: 2        # 2 décimales (ex: 85.42%)
  round: down         # Arrondir vers le bas (conservateur)
  range: 70...90      # vert >90%, jaune 70-90%, rouge <70%

  status:
    project:
      default:
        target: 85%   # Objectif global du projet
        threshold: 2% # Tolérance de régression entre commits
    patch:
      default:
        target: 80%   # Tout nouveau code doit être couvert à 80%
        threshold: 5%

# ============================================================================
# COMMENTAIRES SUR LES PULL REQUESTS
# ============================================================================
comment:
  layout: reach,diff,flags,files
  behavior: default
  require_changes: false

# ============================================================================
# COMPONENTS — Organisation logique des modules
# Un seul upload dans le workflow, codecov fait le découpage.
# Pour ajouter un composant : copier un bloc et adapter paths + target.
# ============================================================================
component_management:

  # Règles par défaut appliquées à tous les composants
  default_rules:
    statuses:
      - type: project
        target: 85%
      - type: patch
        target: 80%

  individual_components:

    # --------------------------------------------------------------------------
    # CORE : Traits et structures fondamentales (physics + solver interfaces)
    # Cible élevée car c'est le contrat de toute l'architecture
    # --------------------------------------------------------------------------
    - component_id: core
      name: "Core Architecture"
      paths:
        - src/physics/traits.rs
        - src/physics/data.rs
        - src/solver/traits.rs
        - src/solver/mod.rs
      statuses:
        - type: project
          target: 90%

    # --------------------------------------------------------------------------
    # PHYSICS : Modèles physiques (isothermes Henry, Langmuir, etc.)
    # --------------------------------------------------------------------------
    - component_id: physics
      name: "Physical Models"
      paths:
        - src/physics/**

    # --------------------------------------------------------------------------
    # SOLVER : Méthodes numériques (Euler, RK4, etc.)
    # --------------------------------------------------------------------------
    - component_id: solver
      name: "Numerical Solvers"
      paths:
        - src/solver/**

    # --------------------------------------------------------------------------
    # MODELS : Modèles Langmuir mono et multi-espèces
    # --------------------------------------------------------------------------
    - component_id: models
      name: "Langmuir Models"
      paths:
        - src/models/**

    # --------------------------------------------------------------------------
    # VISUALIZATION : Génération de chromatogrammes PNG/SVG
    # Cible plus souple car le rendu graphique est difficile à tester unitairement
    # --------------------------------------------------------------------------
    - component_id: visualization
      name: "Visualization"
      paths:
        - src/output/visualization/**
      statuses:
        - type: project
          target: 75%

    # --------------------------------------------------------------------------
    # CSV : Export des résultats au format CSV
    # Décommenter quand le module sera implémenté
    # --------------------------------------------------------------------------
    # - component_id: csv
    #   name: "CSV Export"
    #   paths:
    #     - src/output/csv/**
    #   statuses:
    #     - type: project
    #       target: 75% # Cible plus souple pour le csv

# ============================================================================
# FICHIERS IGNORÉS
# Ne pas mesurer la couverture des tests, exemples et benchmarks
# ============================================================================
ignore:
  - tests/
  - examples/
  - benches/
  - "**/*_test.rs"

# ============================================================================
# INTÉGRATION GITHUB
# ============================================================================
github_checks:
  annotations: true
